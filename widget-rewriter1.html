<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AI Blog Rewriter (200-word limit)</title>
<style>
  body { font-family: Arial, sans-serif; background:#f9f9f9; margin:0; }
  .card { max-width: 520px; margin: 24px auto; background: linear-gradient(135deg, #fff8dc 0%, #ffeb99 25%, #f9a825 50%, #ffeb99 75%, #fff8dc 100%); padding:20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,.08); }
  h2 { margin:0 0 10px; text-align:center; font-size:1.2rem; }
  textarea { width:100%; min-height:140px; border:1px solid #ccc; border-radius:8px; padding:10px; font-size:.95rem; }
  .row { display:flex; justify-content:space-between; align-items:center; margin-top:8px; }
  .muted { color:#666; font-size:.85rem; }
  .counter { font-weight:bold; }
  .counter.over { color:#c62828; }
  button { width:100%; margin-top:12px; padding:10px; border:none; border-radius:8px; background: linear-gradient(90deg, #e63946, #ff8c42); color:#fff; font-weight:700; cursor:pointer; }
  button:disabled { opacity:.6; cursor:not-allowed; }
  .out { margin-top:14px; background:#f1f1f1; padding:10px; border-radius:8px; white-space:pre-wrap; font-size:.95rem; display:none; }
  footer { text-align:center; margin-top:12px; font-size:.85rem; }
  footer a { color:#0077cc; text-decoration:none; font-weight:700; }
</style>
</head>
<body>
<div class="card">
  <h2>Content Rewriter - AI Tool</h2>

  <textarea id="input" placeholder="Write anything and get fresh, SEO-optimized content instantly..."></textarea>
  <div class="row">
    <div class="muted">Max 200 words. Keep your brand tone—just cleaner.</div>
    <div class="counter" id="counter">0/200</div>
  </div>

  <button id="rewriteBtn" disabled>Rewrite it now!</button>

  <div id="output" class="out"></div>

  <footer>
    <a href="https://aivideosummary.com/?utm_source=embed&utm_medium=widget&utm_campaign=rewriter_widget" target="_blank" rel="noopener">
      Click to Submit URL or Upload files
    </a>
  </footer>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {

  function wordCount(t){ return (t.trim().match(/\S+/g) || []).length; }
  function trimToMaxWords(t,m){ const w=(t.trim().match(/\S+/g)||[]); return w.length<=m?t:w.slice(0,m).join(' '); }
  function updateState(){
    let txt=input.value;
    if(wordCount(txt)>MAX_WORDS){
      txt=trimToMaxWords(txt,MAX_WORDS);
      const s=input.selectionStart||txt.length;
      input.value=txt;
      input.selectionEnd=input.selectionStart=Math.min(s,input.value.length);
    }
    const c=wordCount(input.value);
    counter.textContent=c+'/'+MAX_WORDS;
    counter.classList.toggle('over',c>MAX_WORDS);
    rewriteBtn.disabled=(c===0||c>MAX_WORDS);
  }
  input.addEventListener('input',updateState);
  input.addEventListener('paste',()=>setTimeout(updateState,0));
  updateState();

  // TODO: point this to ONE working sync endpoint that returns JSON with
  // { formatted_output } or { full_article }.
  // For now it's a placeholder; change it when you confirm the path.
  const SYNC_ENDPOINT = '/rewrite_direct_content';

  rewriteBtn.addEventListener('click', async () => {
    const text = input.value.trim();
    if (!text) return;

    rewriteBtn.disabled = true;
    rewriteBtn.textContent = 'Rewriting…';
    output.style.display = 'none';
    output.textContent = '';

    try {
      const res = await fetch(SYNC_ENDPOINT, {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        credentials: 'same-origin',
        body: JSON.stringify({ content: text })
      });

      // Try to parse JSON; if server sent HTML (e.g., 405 page), show readable error
      let data;
      try { data = await res.clone().json(); } catch { data = await res.text(); }

      if (!res.ok) {
        const msg = typeof data === 'string' ? data.slice(0,300) : (data.error || 'Rewrite failed');
        throw new Error(msg);
      }

      const out = (data && (data.formatted_output || data.full_article || data.rewritten || data.text)) || '';
      output.textContent = out || '(No output returned)';
      output.style.display = 'block';
    } catch (err) {
      output.textContent = 'Error: ' + (err.message || err);
      output.style.display = 'block';
    } finally {
      rewriteBtn.disabled = false;
      rewriteBtn.textContent = 'Rewrite';
    }
  });
});
</script>
</body>
</html>
